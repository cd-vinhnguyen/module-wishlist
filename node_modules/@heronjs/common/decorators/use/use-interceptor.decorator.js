"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UseInterceptors = void 0;
const reflector_1 = require("../../reflector");
const declarations_1 = require("../../declarations");
const utils_1 = require("../../utils");
const UseInterceptors = (interceptors) => {
    return (target, propertyKey) => {
        let controllers = (0, reflector_1.__obtain)(declarations_1.CTRL_INTERCEPTORS, target);
        if (!propertyKey) {
            if (!controllers)
                controllers = new Map();
            controllers.set(target.name, interceptors);
            (0, reflector_1.__mixin)(target, {
                name: declarations_1.CTRL_INTERCEPTORS,
                refers: controllers,
            });
        }
        else {
            let routes = (0, reflector_1.__obtain)(declarations_1.ROUTE_INTERCEPTORS, target.constructor);
            if (!routes)
                routes = new Map();
            const routeKey = `${target.constructor.name}:${(0, utils_1.isSymbol)(propertyKey) ? propertyKey.toString() : propertyKey}`;
            routes.set(routeKey, interceptors);
            (0, reflector_1.__mixin)(target.constructor, {
                name: declarations_1.ROUTE_INTERCEPTORS,
                refers: routes,
            });
        }
    };
};
exports.UseInterceptors = UseInterceptors;
