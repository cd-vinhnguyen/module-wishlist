"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Guard = exports.GateKeeper = void 0;
const reflector_1 = require("../../reflector");
const declarations_1 = require("../../declarations");
const utils_1 = require("../../utils");
/**
 * Module secure context Declaration
 * @param context : @link(SecureContext)
 * @param resolver
 * @decorator
 */
const GateKeeper = (context, resolver) => (target) => {
    (0, reflector_1.__mixin)(target, { name: declarations_1.MODULE_GATEKEEPER, refers: context });
    (0, reflector_1.__mixin)(context, { name: declarations_1.SELF_RESOLVER, refers: resolver });
};
exports.GateKeeper = GateKeeper;
/**
 * route secure context
 * @param guard
 * @link(SecureProperty)
 * @decorator
 */
const Guard = (guard) => (target, propertyKey) => {
    const isMethodDecorator = !!propertyKey;
    const obj = isMethodDecorator ? target.constructor : target;
    let guardContext = (0, reflector_1.__obtain)(declarations_1.CTRL_GUARD, obj);
    let key;
    if (!guardContext) {
        guardContext = {};
    }
    isMethodDecorator ? key = (0, utils_1.isSymbol)(propertyKey) ? propertyKey.toString() : propertyKey
        : key = target.name;
    guardContext[key] = { isController: !isMethodDecorator, property: guard };
    (0, reflector_1.__mixin)(obj, { name: declarations_1.CTRL_GUARD, refers: guardContext });
};
exports.Guard = Guard;
