"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fromConnectionString = void 0;
const url_1 = require("url");
const consts_1 = require("../../consts");
const errors_1 = require("../../errors");
const DB_USER_NAME = 'user';
const DB_PASSWORD = 'password';
const DB_DATABASE = 'database';
const fromConnectionString = (connectionString) => {
    const urls = connectionString.split(';');
    const configs = [];
    for (const url of urls) {
        const validUrl = new url_1.URL(url);
        const host = validUrl.hostname;
        const port = validUrl.port ? parseInt(validUrl.port, 10) : -1;
        const user = validUrl.searchParams.get(DB_USER_NAME);
        const password = validUrl.searchParams.get(DB_PASSWORD);
        const database = validUrl.searchParams.get(DB_DATABASE);
        const conf = { user, password, host, port, database };
        if (!configs.some((predict) => `${predict.config.host}:${predict.config.port}` === `${conf.host}:${conf.port}`)) {
            configs.push({ config: conf });
        }
    }
    if (configs)
        return configs;
    throw new errors_1.SQLError(consts_1.SQLErrors.CONNECTION_ERR, 'Can not read slaves database connection config');
};
exports.fromConnectionString = fromConnectionString;
